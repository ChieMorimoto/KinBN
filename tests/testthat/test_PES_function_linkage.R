
test_that("PES_function_linkage",{
  pat <- c(0,0,1,1)
  mat <- c(0,0,2,2)
  id <- c(1,2,3,4)
  DNAtype <- c(0,0,1,2)

  sibling.dataframe <-  data.frame(pat,mat,id,DNAtype, stringsAsFactors = F )

  sibling.alleletype <- array(NA,dim=c(2,21,2,1))
  sibling.alleletype[,,1,] <- matrix(c(16,17,17,17,9,9,12,12,8,12,15,15,30,30,13,15,10,14,
                                       13.2,14,7,8,23,24,11,15,11,12,12,13,11,11,18,27.2,
                                       14,15,12,18,18,19,23,23),2,21)
  sibling.alleletype[,,2,] <- matrix(c(16,16,17,18,9,9,12,13,8,10,10,14,30,32.2,13,14,10,14,
                                       14,14,7,8,22,24,15,16,11,12,12,13,11,11,18,26.2,
                                       14,15,17,17.3,18,19,23,25),2,21)

  Mutation_pat <- matrix(c(rep(0,42),rep(1,21),rep(0,42)),21,5)
  Mutation_mat <- matrix(c(rep(0,42),rep(1,21),rep(0,42)),21,5)

  Cau.GF.aList <- list()
  Cau.GF.aList[[1]] <- c(11,13,14,15,16,17,18,19,20)
  Cau.GF.aList[[2]] <- c(12,13,14,15,16,17,18,19,20,21)
  Cau.GF.aList[[3]] <- c(8,9,10,11,12,13,14)
  Cau.GF.aList[[4]] <- c(8,9,10,11,12,13,14)
  Cau.GF.aList[[5]] <- c(5,6,8,9,10,11,12,13)
  Cau.GF.aList[[6]] <- c(8,9,10,11,12,13,14,15,16,17)
  Cau.GF.aList[[7]] <- c(25.2,27,28,29,29.2,30,30.2,31,31.2,32,32.2,33,33.2,34.2,35,36)
  Cau.GF.aList[[8]] <- c(10,11,12,13,14,14.2,15,16,16.2,17,18,19,20,21,22)
  Cau.GF.aList[[9]] <- c(9,9.1,10,11,11.3,12,12.3,13,14,15,16)
  Cau.GF.aList[[10]] <- c(10,11,12,12.2,13,13.2,14,14.2,15,15.2,16,16.2,17,17.2,18.2)
  Cau.GF.aList[[11]] <- c(5,6,7,8,9,9.3,10,11)
  Cau.GF.aList[[12]] <- c(18,19,20,21,21.2,22,22.2,23,23.2,24,24.2,25,26,27)
  Cau.GF.aList[[13]] <- c(11,12,13,14,15,16,17,18)
  Cau.GF.aList[[14]] <- c(7,8,9,10,11,12,13,14,15)
  Cau.GF.aList[[15]] <- c(8,9,10,11,12,13,14,15)
  Cau.GF.aList[[16]] <- c(7,8,8.1,9,10,11,12,13,14)
  Cau.GF.aList[[17]] <- c(11,12,13,14,14.2,15,16,16.2,17,17.3,18,19,19.2,20,20.2,21,21.2,22,22.2,23,23.2,24,24.2,25.2,26.2,27.2,28.2,28.3,29.2,30.2,31,31.2,32,32.2,33,33.2,34,34.2)
  Cau.GF.aList[[18]] <- c(11,12,13,14,15,16,17,18,19)
  Cau.GF.aList[[19]] <- c(10,11,12,13,14,14.3,15,15.3,16,16.3,17,17.3,18,18.3,19.3)
  Cau.GF.aList[[20]] <- c(15,16,17,17.3,18,18.3,19,19.3,20,21,22,23,24,25,26,27)
  Cau.GF.aList[[21]] <- c(15,16,17,18,19,20,21,22,23,24,25,26)

  Cau.GF.pList <- list()
  Cau.GF.pList[[1]] <- c(1,1,77,197,172,152,109,12,1)
  Cau.GF.pList[[2]] <- c(1,1,67,76,145,205,146,75,5,1)
  Cau.GF.pList[[3]] <- c(13,77,41,227,227,118,19)
  Cau.GF.pList[[4]] <- c(4,10,159,223,260,59,7)
  Cau.GF.pList[[5]] <- c(1,1,379,92,36,182,30,1)
  Cau.GF.pList[[6]] <- c(10,4,74,55,121,238,120,75,24,1)
  Cau.GF.pList[[7]] <- c(1,16,115,146,2,204,21,52,71,4,65,1,19,3,1,1)
  Cau.GF.pList[[8]] <- c(6,7,82,89,97,1,123,106,1,100,56,29,13,7,5)
  Cau.GF.pList[[9]] <- c(1,1,152,248,44,34,3,21,174,43,1)
  Cau.GF.pList[[10]] <- c(1,4,51,1,184,5,261,17,113,26,41,11,5,1,1)
  Cau.GF.pList[[11]] <- c(1,170,140,69,86,249,6,1)
  Cau.GF.pList[[12]] <- c(18,36,89,129,4,148,9,110,2,97,1,57,19,3)
  Cau.GF.pList[[13]] <- c(101,9,5,41,232,276,54,4)
  Cau.GF.pList[[14]] <- c(2,4,30,40,257,280,103,5,1)
  Cau.GF.pList[[15]] <- c(87,56,34,235,194,84,31,1)
  Cau.GF.pList[[16]] <- c(20,104,1,121,185,148,115,25,3)
  Cau.GF.pList[[17]] <- c(1,5,12,18,2,29,29,1,45,1,53,52,3,42,7,18,17,10,27,2,26,1,16,30,30,68,55,1,40,41,2,17,1,9,1,3,6,1)
  Cau.GF.pList[[18]] <- c(1,23,222,215,142,96,20,1,2)
  Cau.GF.pList[[19]] <- c(2,56,84,48,57,2,108,42,98,44,34,96,4,36,11)
  Cau.GF.pList[[20]] <- c(23,16,92,15,124,18,90,3,80,93,69,50,34,12,2,1)
  Cau.GF.pList[[21]] <- c(1,27,134,53,87,113,27,25,76,83,74,22)

  sibling.data <- list(
    df=sibling.dataframe,
    alleletype=sibling.alleletype,
    target_number=3,
    mutation_pat=Mutation_pat,
    mutation_mat=Mutation_mat,
    aList=Cau.GF.aList,
    pList=Cau.GF.pList,
    linkage.loci=rbind(c(9,5),c(4,14),c(20,2)),
    RR = c(0.4721,0.2522,0.1172)
  )

  expect_equal(round(PES_function_linkage(sibling.data, 1, 0.001, 1:21),digits=3),
               round(matrix(c( 1.319394, 1, 26.76072, 1.673908, 1, 0.25,
                               1.168352, 1.281964, 1.95163, 0.9647277, 9.077448, 1.196464,
                               0.6416346, 1, 5.849857, 8.80006, 2.083542, 3.533881,
                               0.25, 6.58002, 2.64288),1,21),digits=3))
})

